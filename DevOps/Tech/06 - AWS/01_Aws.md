# AWS
- AWS is a collection of services grouped into categories.
- You dont have to learn all services
- Based on what you are working on you will need a handful of services.

We are gonna use:
- Compute: EC2 
- Storage
- Network: VPC
- Security: IAM

With every IAM account you can create infrastracture in Region 1, Region 2...
Every region will have development zones (actual datacenters) that run virtual machine.

Depending on the hierarchy level different scopes will have different resources.
Global scope is IAM user, which has global access, Billing, rount 53.
Region has S3, VPC, Dynamo
Virtual servers have EC2, EBS, RDS

IAM - Identity and access management
You can create user and user groups and assign permission to services
By default root user is created and has unlimited access.
Better create admin user, with less privileges. 

IAM User - is created for human or system users. For example DevOps person can have access to EC2 services.

IAM > Add user > 
Username: admin
Access type: Both AWS console and Programmatic access
Console Password: Autogenerated, Require password reset
Next > We will skip groups and attach directly
Attach existing policies directly
- Administrator access policies
Att tags to user, like email, or job description, name surname
Next > Create User
- Download .csv and you can use for credential

Log in again
IAM user
account id is in csv file. You can use link in csv to go to page
It will ask for specifing password

Regija desno gore se bira


VPC is virtual private cloud. Virtual presentation of network infrastracture
You create your service withing VPC, and VPC are availble per region.

Subnets - are subnetworks. THose are components of VPC.
FOr each availbality zone you will have sub network.
You can block outside network from subnet, block all ports, that is how you create private subnet.
But other apps in VPC will be able to access.

VPC will have internal IP range. And each service in subnets will have internal IP address.

Each service will get private and public IP addresses.
For connecting service to outside you can use internet gateway.

Access can be defined by instance service or by subnet. By blocking or allowing ports.

Configure access on subnet - NACL
configure access on instance level - security gorup

CIDR block is a range of IP address
173.31.0.0/16
172.31.0.0-172.31.255.255
The lower the /16 number the more of the range. 16 is the number of fixed digits in binary
Subnet calculator
You can assign this CIDR to a subnet to define range.

# EC2 Service
Amazon Elastic Compute CLoud. This is a service running a cloud.
We are gonna deploy web application on EC2.
1. Create EC2 to AWS
2. Connect to EC2 with ssh
3. Install Docker on remote EC2
4. Run docker container
5. Configure EC2 Firewall to access application

Select ec2 instance.
Each instance is configrauble.
t2.micro free tier eligible.
number of instance 1
network default

One vpc is created by default for each region. Each vpc has 3 availability zones. 
Each zone has a subnet.
auto-assign: Use subnet setting enable
advanced: leave default
Next> Add storage size 8
Next> Add tags as metadata for yourself or team member
Next> Configre security group SSH 22 Custom 0 0000. Keep default 
To lock IP access: Pick my IP: it will autodetect. 
Security group name: security-group-docker-server
Next > Review
Launch
You need to create key pair
You need to paste public key in there.
Here you create keys in AWS and then download private key locally
Create a new key pair: name docker-server
Download key pair

Launch instance

Ec2 Dahsboard, you will instance. CLick on instance
you can see in which subnet it was launched into

copy ssh key to folder
mv Downloads/docker-server.pem home/.ssh
ls -l .ssh/docker-server.pem
chmod 400 .ssh/docker-server.pem
# it will be available only as read.
.ssh/docker-server.pem
# dont log in as root. Instead default user ec2-user
ssh -i /home/.ssh/docker-server.pem ec2-user@15.236.202.138
whoami
ec2-user

## Install docker on EC2
sudo yum update
sudo yum install docker
docker --version
sudo service docker start
ps aux | grep docker
sudo usermod -aG docker $USER
groups
docker run redis
docker ps
docker pull nanajanashia/demo-app:tagname
# build it locally and push to private docker hub

docker login
username
password
a new file is created 
in home .docker/config.json.
This will have auth token now
docker run -d -p 3000:3090 nanaimage
in instance view of ec2 there is a security tab and group with firewall rules
click on security group and Edit inbound rule - custom 00000 port 3080
click on security group and Edit outbound rule - outside to internet like docker
go back to instance > networking take ip port 3000
and you can access aplication
or dns name

